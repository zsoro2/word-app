# Appwrite Setup Guide for VocabMaster

This guide will walk you through setting up Appwrite for the VocabMaster vocabulary learning app.

## Step 1: Create an Appwrite Account & Project

1. Go to [Appwrite Cloud](https://cloud.appwrite.io) and create an account (or self-host)
2. Create a new project called "VocabMaster"
3. Note your **Project ID** from the project settings

## Step 2: Set Up Authentication

1. Go to **Auth** → **Settings**
2. Enable **Email/Password** authentication
3. (Optional) Configure password requirements

## Step 3: Create the Database

1. Go to **Databases** → **Create Database**
2. Name it `vocabmaster` (or any name you prefer)
3. Note your **Database ID**

## Step 4: Create Collections

### Folders Collection

1. Click **Create Collection**
2. Name: `folders`
3. Collection ID: You can use auto-generated or set custom (note this ID)
4. Permissions: See below

**Attributes for `folders`:**

| Attribute Key | Type   | Size | Required | Default |
|--------------|--------|------|----------|---------|
| `name`       | String | 100  | Yes      | -       |
| `color`      | String | 7    | Yes      | -       |
| `userId`     | String | 36   | Yes      | -       |

**Indexes for `folders`:**

| Key          | Type | Attributes  | Orders |
|--------------|------|-------------|--------|
| `userId_idx` | Key  | `userId`    | ASC    |

### Words Collection

1. Click **Create Collection**
2. Name: `words`
3. Collection ID: Note this ID
4. Permissions: See below

**Attributes for `words`:**

| Attribute Key   | Type   | Size | Required | Default |
|----------------|--------|------|----------|---------|
| `leftWord`     | String | 200  | Yes      | -       |
| `leftExample`  | String | 500  | No       | -       |
| `rightWord`    | String | 200  | Yes      | -       |
| `rightExample` | String | 500  | No       | -       |
| `folderId`     | String | 36   | Yes      | -       |
| `userId`       | String | 36   | Yes      | -       |

**Indexes for `words`:**

| Key              | Type | Attributes            | Orders    |
|------------------|------|-----------------------|-----------|
| `userId_idx`     | Key  | `userId`              | ASC       |
| `folder_idx`     | Key  | `userId`, `folderId`  | ASC, ASC  |

## Step 5: Set Collection Permissions

For BOTH collections (`folders` and `words`), set these permissions:

### Document Level Security (Recommended)

Go to **Settings** tab of each collection and enable **Document Security**.

Then, for each collection:

1. Click on **Settings** → **Permissions**
2. Add the following permissions:

**Create:**
- Role: `Users` → Check `Create`

**Read:**
- Role: `Users` → Check `Read`

**Update:**
- Role: `Users` → Check `Update`

**Delete:**
- Role: `Users` → Check `Delete`

> **Note:** With Document Security enabled, users can only access documents where they have specific permissions. The app handles this by setting `userId` on each document.

### Alternative: Using Roles

If you prefer role-based access:

```
Create: role:all (users)
Read: role:all (users)
Update: role:all (users)
Delete: role:all (users)
```

## Step 6: Configure Environment Variables

Create a `.env` file in your project root (copy from `.env.example`):

```env
# Appwrite Configuration
VITE_APPWRITE_ENDPOINT=https://cloud.appwrite.io/v1
VITE_APPWRITE_PROJECT_ID=your_project_id_here
VITE_APPWRITE_DATABASE_ID=your_database_id_here
VITE_APPWRITE_FOLDERS_COLLECTION_ID=your_folders_collection_id_here
VITE_APPWRITE_WORDS_COLLECTION_ID=your_words_collection_id_here
```

Replace the placeholders with your actual IDs from the Appwrite console.

## Step 7: Add Web Platform

1. Go to your project **Settings** → **Platforms**
2. Click **Add Platform** → **Web App**
3. Name: `VocabMaster Web`
4. Hostname: `localhost` (for development)
5. For production, add your production domain

## Collection Schema Reference

### Folders Collection Structure

```typescript
{
  $id: string;           // Auto-generated by Appwrite
  $createdAt: string;    // Auto-generated
  $updatedAt: string;    // Auto-generated
  name: string;          // Folder name
  color: string;         // Hex color (e.g., "#6366F1")
  userId: string;        // Owner's user ID
}
```

### Words Collection Structure

```typescript
{
  $id: string;           // Auto-generated by Appwrite
  $createdAt: string;    // Auto-generated
  $updatedAt: string;    // Auto-generated
  leftWord: string;      // Word in first language
  leftExample: string;   // Example sentence
  rightWord: string;     // Translation
  rightExample: string;  // Translated example
  folderId: string;      // Reference to folder
  userId: string;        // Owner's user ID
}
```

## API Functions Available

The app provides these functions in `src/lib/appwrite.ts`:

### Authentication
- `createAccount(credentials)` - Sign up a new user
- `login(credentials)` - Log in a user
- `logout()` - Log out current user
- `getCurrentUser()` - Get current logged-in user
- `updateUserName(name)` - Update user's display name

### Folders
- `getFolders(userId)` - Get all folders for a user
- `createFolder(folder, userId)` - Create a new folder
- `updateFolder(folderId, folder)` - Update a folder
- `deleteFolder(folderId)` - Delete a folder

### Words
- `getWords(userId)` - Get all words for a user
- `getWordsByFolder(userId, folderId)` - Get words in a specific folder
- `createWord(word, userId)` - Create a new word
- `updateWord(wordId, word)` - Update a word
- `deleteWord(wordId)` - Delete a word
- `moveWordsToFolder(userId, fromFolderId, toFolderId)` - Move words between folders

## Testing the Setup

1. Start the development server:
   ```bash
   npm run dev
   ```

2. Open http://localhost:3000

3. You should be redirected to the login page

4. Create an account and test the features:
   - Create folders
   - Add words to folders
   - View and shuffle words
   - Update your profile

## Troubleshooting

### "Failed to fetch data" Error
- Check your environment variables are correct
- Ensure collections have proper permissions
- Verify your Appwrite endpoint is accessible

### "Unauthorized" Error
- Make sure email/password auth is enabled
- Check collection permissions
- Verify the web platform hostname is configured

### Words/Folders Not Showing
- Verify the `userId` attribute exists in both collections
- Check that indexes are created properly
- Ensure document security is configured correctly

## Security Best Practices

1. **Never commit `.env` files** - They're in `.gitignore`
2. **Use Document Security** - Ensures users only see their own data
3. **Validate on both client and server** - Use Appwrite functions for additional validation if needed
4. **Set up proper CORS** - Only allow your domains in production

